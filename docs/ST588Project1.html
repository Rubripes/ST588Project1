<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>quarto-inputad2008c81cd35284</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


</head>

<body class="fullcontent">

<div id="quarto-search-results"></div>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
<!-- margin-sidebar -->
    
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><div class="line-block">ST588 Project 1<br>
Matt Bray<br>
Tyler Hunt</div></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<section id="project-introduction" class="level2">
<h2 class="anchored" data-anchor-id="project-introduction">Project Introduction</h2>
<p>In our Data Science for Statisticians course we have learning how to do the following:</p>
<ol type="1">
<li>Work with Base R</li>
<li>Leverage the tidyverse library to read, manipulate and analyze data</li>
<li>Build functions</li>
<li>Build API Calls</li>
</ol>
<p>Using this (nonexhaustive) list of skills and more, we are going to explore person-level data within the Public Use Microdata Sample (PUMS) Census dataset. Throughout this document we will build functions to read, summarize and plot the data. We will provide a narrative that explains the code and the functionality.</p>
</section>
<section id="install-packages" class="level2">
<h2 class="anchored" data-anchor-id="install-packages">Install Packages</h2>
<p>Before getting into functions and technical details, it is important that the user have the appropriate packages installed and read into the session. Without these libraries the code will <em>NOT</em> run.</p>
<p><em>Notes for user: You should load the packages in the below code chunk using install.packages() to load on your local machine.</em></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">"tidyverse"</span>)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">"censusapi"</span>)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">"tidycensus"</span>)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">"jsonlite"</span>)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">"dplyr"</span>)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">"lubridate"</span>)</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">"ggplot2"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="basic-api-testing" class="level2">
<h2 class="anchored" data-anchor-id="basic-api-testing">Basic API Testing</h2>
<p>Before building our API from scratch, lets use a specific API URL to ensure that we can retrieve data from the API, parse the data, and format as a tibble.</p>
<p>Below we are calling the GET function from the httr library to retrieve data from this API URL <a href="https://api.census.gov/data/2022/acs/acs1/pums?get=SEX,PWGTP,MAR&amp;SCHL=24" class="uri">https://api.census.gov/data/2022/acs/acs1/pums?get=SEX,PWGTP,MAR&amp;SCHL=24</a>. Feel free to copy and paste this into your web browser. You should see some data in your web browser.</p>
<p>In the below, the output is less friendly…</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>censusApiTest <span class="ot">&lt;-</span> httr<span class="sc">::</span><span class="fu">GET</span>(<span class="fu">paste</span>(<span class="st">'https://api.census.gov/data/2022/acs/acs1/pums?get=SEX,PWGTP,MAR&amp;SCHL=24'</span>))</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>censusApiTest</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Response [https://api.census.gov/data/2022/acs/acs1/pums?get=SEX,PWGTP,MAR&amp;SCHL=24]
  Date: 2024-10-05 15:01
  Status: 200
  Content-Type: application/json;charset=utf-8
  Size: 938 kB
[["SEX","PWGTP","MAR","SCHL"],
["2","6","5","24"],
["2","23","2","24"],
["1","23","3","24"],
["1","80","5","24"],
["1","16","1","24"],
["1","107","3","24"],
["2","10","5","24"],
["1","22","1","24"],
["2","127","5","24"],
...</code></pre>
</div>
</div>
<p>Below, we are building a function that takes the raw data (the input) and returns a tibble as the output. We are using a combination of pre-built functions from our libraries to parse the raw data to JSON. The first row represents our column headers while the rest of the rows represent the data points.</p>
<p>We construct the tibble by passing the data points and using our headers to assign column names to the tibble.</p>
<p>You can see the output is much prettier (and easier to work with) than before!</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>rawToTibble <span class="ot">&lt;-</span> <span class="cf">function</span>(rawData){</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>  jsonData <span class="ot">&lt;-</span> <span class="fu">fromJSON</span>(<span class="fu">rawToChar</span>(rawData<span class="sc">$</span>content))</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>  <span class="do">## Extract column names</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>  colNames <span class="ot">&lt;-</span> jsonData[<span class="dv">1</span>,]</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Remove the first row from the data </span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>  jsonData <span class="ot">&lt;-</span> jsonData[<span class="sc">-</span><span class="dv">1</span>,]</span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>  tibbleData <span class="ot">&lt;-</span> <span class="fu">as_tibble</span>(jsonData)</span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">colnames</span>(tibbleData) <span class="ot">&lt;-</span> colNames</span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(tibbleData)</span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a><span class="fu">rawToTibble</span>(censusApiTest)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 44,079 × 4
   SEX   PWGTP MAR   SCHL 
   &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt;
 1 2     6     5     24   
 2 2     23    2     24   
 3 1     23    3     24   
 4 1     80    5     24   
 5 1     16    1     24   
 6 1     107   3     24   
 7 2     10    5     24   
 8 1     22    1     24   
 9 2     127   5     24   
10 2     46    5     24   
# ℹ 44,069 more rows</code></pre>
</div>
</div>
</section>
<section id="some-helper-functions-for-querying-the-api" class="level2">
<h2 class="anchored" data-anchor-id="some-helper-functions-for-querying-the-api">Some Helper Functions for Querying the API</h2>
<p>Our functions used the build and query APIs rely on a series of other functions. These other functions were built to segment complex problems into modules, reduce duplicate code and improve readability for technical users.</p>
<p>Brief explanations fo each helper function:</p>
<ol type="1">
<li><em>checkVarsValid</em> - Our function used to query the API can only accept certain variables. This function ensures the variables passed by the user (vars) are all in the list of valid variables (validVars). If not, the function will stop and tell the user that they have provided an invalid variable(s).</li>
<li><em>varsLkpTibble</em> - Sometimes our variables require that the user lookup those variables and fetch a different attribute from that lookup. These values can vary year to year, so the user must pass the year, the name of the variable and a column name for the lookup value (just “lkpVal” by default). A tibble is returned.</li>
<li><em>midTimeFunc</em> - Some variables represent an interval of time. We want to return the midpoint of that interval, but the raw data type is not user friendly. This function takes start and ends of the interval in the format “3:29 p.m.” and transforms into HMS format</li>
<li><em>lkpToMiddleTime</em> - This helper function leverages our two (2) previous helper functions to lookup time intervals in the string format “3:29 p.m. to 3:33 p.m”, retrieve the median in the interval, cast as HMS format and return the transformed tibble.</li>
<li><em>factorLkp</em> - When given categorical variables as integers (1,2,3…etc) we want to return meaningful character values. We again use our helper function <em>varsLkpTibble</em> to lookup the values for a specific year. Using the factor() function, we pass our original data points, an ordered list of integers as our levels and the paired character values as our labels. This is also applied directly to a tibble</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>checkVarsValid <span class="ot">&lt;-</span> <span class="cf">function</span>(vars,validVars){</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="sc">!</span><span class="fu">all</span>(vars <span class="sc">%in%</span> validVars)) {</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stop</span>(<span class="st">"Invalid variables: "</span>, <span class="fu">paste</span>(vars[<span class="sc">!</span>vars <span class="sc">%in%</span> validVars], <span class="at">collapse =</span> <span class="st">", "</span>))</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>varsLkpTibble <span class="ot">&lt;-</span> <span class="cf">function</span>(year,varName,<span class="at">lkpVal=</span><span class="st">"lkpVal"</span>){</span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>  rawData <span class="ot">&lt;-</span> httr<span class="sc">::</span><span class="fu">GET</span>(<span class="at">url=</span><span class="fu">paste0</span>(<span class="st">'https://api.census.gov/data/'</span>,year,<span class="st">'/acs/acs1/pums/variables/'</span>,varName,<span class="st">'.json'</span>))</span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>  jsonData <span class="ot">&lt;-</span> <span class="fu">fromJSON</span>(<span class="fu">rawToChar</span>(rawData<span class="sc">$</span>content))</span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>  tibbleData <span class="ot">&lt;-</span> <span class="fu">as_tibble</span>(jsonData<span class="sc">$</span>values<span class="sc">$</span>item)</span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>  tibbleData <span class="ot">&lt;-</span> tibbleData <span class="sc">%&gt;%</span></span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">pivot_longer</span>(<span class="at">cols=</span><span class="fu">names</span>(tibbleData),</span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a>                 <span class="at">names_to =</span> varName,</span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a>                 <span class="at">values_to =</span> lkpVal</span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a>                 )</span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(tibbleData)</span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a>midTimeFunc <span class="ot">&lt;-</span> <span class="cf">function</span>(startTime,endTime){</span>
<span id="cb6-20"><a href="#cb6-20" aria-hidden="true" tabindex="-1"></a>  midAddlSecs <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">difftime</span>(endTime,startTime,<span class="at">units=</span><span class="st">"secs"</span>))<span class="sc">/</span><span class="dv">2</span></span>
<span id="cb6-21"><a href="#cb6-21" aria-hidden="true" tabindex="-1"></a>  midTotalSecs <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(startTime) <span class="sc">+</span> midAddlSecs</span>
<span id="cb6-22"><a href="#cb6-22" aria-hidden="true" tabindex="-1"></a>  midhours <span class="ot">&lt;-</span> <span class="fu">floor</span>(midTotalSecs<span class="sc">/</span>(<span class="dv">60</span><span class="sc">*</span><span class="dv">60</span>))</span>
<span id="cb6-23"><a href="#cb6-23" aria-hidden="true" tabindex="-1"></a>  midminutes <span class="ot">&lt;-</span> <span class="fu">floor</span>((midTotalSecs<span class="sc">-</span>(<span class="dv">60</span><span class="sc">*</span><span class="dv">60</span><span class="sc">*</span>midhours))<span class="sc">/</span><span class="dv">60</span>)</span>
<span id="cb6-24"><a href="#cb6-24" aria-hidden="true" tabindex="-1"></a>  midseconds <span class="ot">&lt;-</span> <span class="fu">floor</span>((midTotalSecs<span class="sc">-</span>(<span class="dv">60</span><span class="sc">*</span><span class="dv">60</span><span class="sc">*</span>midhours)<span class="sc">-</span><span class="dv">60</span><span class="sc">*</span>midminutes)<span class="sc">/</span><span class="dv">60</span>)</span>
<span id="cb6-25"><a href="#cb6-25" aria-hidden="true" tabindex="-1"></a>  timeString <span class="ot">&lt;-</span> <span class="fu">paste</span>(midhours,midminutes,midseconds,<span class="at">sep=</span><span class="st">":"</span>)</span>
<span id="cb6-26"><a href="#cb6-26" aria-hidden="true" tabindex="-1"></a>  hmsTime <span class="ot">&lt;-</span> hms<span class="sc">::</span><span class="fu">parse_hms</span>(timeString)</span>
<span id="cb6-27"><a href="#cb6-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(timeString)</span>
<span id="cb6-28"><a href="#cb6-28" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb6-29"><a href="#cb6-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-30"><a href="#cb6-30" aria-hidden="true" tabindex="-1"></a>lkpToMiddleTime <span class="ot">&lt;-</span> <span class="cf">function</span>(tibble,<span class="at">year=</span><span class="dv">2022</span>,timeVar){</span>
<span id="cb6-31"><a href="#cb6-31" aria-hidden="true" tabindex="-1"></a>  apiData <span class="ot">&lt;-</span> <span class="fu">varsLkpTibble</span>(<span class="at">year=</span>year,<span class="at">varName =</span> timeVar,<span class="at">lkpVal =</span> <span class="st">"TIME_INTERVAL"</span>)</span>
<span id="cb6-32"><a href="#cb6-32" aria-hidden="true" tabindex="-1"></a>  intervalTibble <span class="ot">&lt;-</span> <span class="fu">inner_join</span>(tibble,apiData)</span>
<span id="cb6-33"><a href="#cb6-33" aria-hidden="true" tabindex="-1"></a>  returnData <span class="ot">&lt;-</span> intervalTibble <span class="sc">%&gt;%</span></span>
<span id="cb6-34"><a href="#cb6-34" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(timeVar)) <span class="sc">%&gt;%</span></span>
<span id="cb6-35"><a href="#cb6-35" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">TIME_INTERVAL =</span> <span class="fu">ifelse</span>(TIME_INTERVAL <span class="sc">==</span> <span class="st">"N/A (not a worker; worker who worked from home)"</span>, <span class="cn">NA</span>, TIME_INTERVAL))</span>
<span id="cb6-36"><a href="#cb6-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">names</span>(returnData) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">names</span>(returnData)[<span class="dv">1</span><span class="sc">:</span>(<span class="fu">length</span>(<span class="fu">names</span>(returnData))<span class="sc">-</span><span class="dv">1</span>)],timeVar)</span>
<span id="cb6-37"><a href="#cb6-37" aria-hidden="true" tabindex="-1"></a>  returnData <span class="ot">&lt;-</span> returnData <span class="sc">%&gt;%</span></span>
<span id="cb6-38"><a href="#cb6-38" aria-hidden="true" tabindex="-1"></a>    <span class="fu">separate_wider_delim</span>(timeVar,<span class="at">delim =</span> <span class="st">" to "</span>,<span class="at">names=</span><span class="fu">c</span>(<span class="st">'StartTime'</span>,<span class="st">'EndTime'</span>),<span class="at">too_few=</span><span class="fu">c</span>(<span class="st">'align_start'</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb6-39"><a href="#cb6-39" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">StartTime =</span> <span class="fu">parse_time</span>(<span class="fu">gsub</span>(<span class="st">"</span><span class="sc">\\</span><span class="st">."</span>, <span class="st">""</span>, StartTime),<span class="at">format =</span> <span class="st">"%I:%M %p"</span>),</span>
<span id="cb6-40"><a href="#cb6-40" aria-hidden="true" tabindex="-1"></a>           <span class="at">EndTime =</span> <span class="fu">parse_time</span>(<span class="fu">gsub</span>(<span class="st">"</span><span class="sc">\\</span><span class="st">."</span>, <span class="st">""</span>, EndTime),<span class="at">format =</span> <span class="st">"%I:%M %p"</span>),</span>
<span id="cb6-41"><a href="#cb6-41" aria-hidden="true" tabindex="-1"></a>           <span class="at">MidTime =</span> <span class="fu">ifelse</span>(<span class="sc">!</span><span class="fu">is.na</span>(StartTime), <span class="fu">midTimeFunc</span>(StartTime,EndTime),<span class="cn">NA</span>)</span>
<span id="cb6-42"><a href="#cb6-42" aria-hidden="true" tabindex="-1"></a>           )</span>
<span id="cb6-43"><a href="#cb6-43" aria-hidden="true" tabindex="-1"></a>  returnData[[timeVar]] <span class="ot">&lt;-</span> hms<span class="sc">::</span><span class="fu">as_hms</span>(returnData<span class="sc">$</span>MidTime)</span>
<span id="cb6-44"><a href="#cb6-44" aria-hidden="true" tabindex="-1"></a>  returnData <span class="ot">&lt;-</span> returnData <span class="sc">%&gt;%</span></span>
<span id="cb6-45"><a href="#cb6-45" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(<span class="st">'StartTime'</span>,<span class="st">'EndTime'</span>,<span class="st">'MidTime'</span>))</span>
<span id="cb6-46"><a href="#cb6-46" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(returnData)</span>
<span id="cb6-47"><a href="#cb6-47" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb6-48"><a href="#cb6-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-49"><a href="#cb6-49" aria-hidden="true" tabindex="-1"></a>factorLkp <span class="ot">&lt;-</span> <span class="cf">function</span>(tibbleData,year,catVar){</span>
<span id="cb6-50"><a href="#cb6-50" aria-hidden="true" tabindex="-1"></a>  apiData <span class="ot">&lt;-</span> <span class="fu">varsLkpTibble</span>(<span class="at">year=</span>year,<span class="at">varName =</span> catVar)</span>
<span id="cb6-51"><a href="#cb6-51" aria-hidden="true" tabindex="-1"></a>  x <span class="ot">&lt;-</span> tibbleData[[catVar]]</span>
<span id="cb6-52"><a href="#cb6-52" aria-hidden="true" tabindex="-1"></a>  levels <span class="ot">&lt;-</span> <span class="fu">sort</span>(<span class="fu">as.numeric</span>(<span class="fu">unique</span>(x)))</span>
<span id="cb6-53"><a href="#cb6-53" aria-hidden="true" tabindex="-1"></a>  apiData[[catVar]] <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(apiData[[catVar]])</span>
<span id="cb6-54"><a href="#cb6-54" aria-hidden="true" tabindex="-1"></a>  apiData <span class="ot">&lt;-</span> apiData <span class="sc">%&gt;%</span></span>
<span id="cb6-55"><a href="#cb6-55" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(<span class="fu">get</span>(catVar) <span class="sc">%in%</span> levels) <span class="sc">%&gt;%</span></span>
<span id="cb6-56"><a href="#cb6-56" aria-hidden="true" tabindex="-1"></a>    <span class="fu">arrange</span>(<span class="fu">get</span>(catVar))</span>
<span id="cb6-57"><a href="#cb6-57" aria-hidden="true" tabindex="-1"></a>  labels <span class="ot">&lt;-</span> apiData<span class="sc">$</span>lkpVal</span>
<span id="cb6-58"><a href="#cb6-58" aria-hidden="true" tabindex="-1"></a>  newVec <span class="ot">&lt;-</span> <span class="fu">factor</span>(<span class="at">x=</span>x,<span class="at">levels=</span>levels,<span class="at">labels =</span> labels)</span>
<span id="cb6-59"><a href="#cb6-59" aria-hidden="true" tabindex="-1"></a>  tibbleData[[catVar]] <span class="ot">&lt;-</span> newVec</span>
<span id="cb6-60"><a href="#cb6-60" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(tibbleData)</span>
<span id="cb6-61"><a href="#cb6-61" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="querying-the-api" class="level2">
<h2 class="anchored" data-anchor-id="querying-the-api">Querying the API</h2>
<p>Finally, we are building our function to query the API.</p>
<section id="inputsparameters" class="level3">
<h3 class="anchored" data-anchor-id="inputsparameters">Inputs/Parameters</h3>
<p>The user will pass the year (default = 2022), a vector of numeric variables (default = “AGEP”,“PWGTP”), a vector of categorical variables (default = “SEX”), a geography level (default = “ALL”). Optionally, the user can also pass the specific identifier for that geography level if they choose.</p>
</section>
<section id="parameter-validation" class="level3">
<h3 class="anchored" data-anchor-id="parameter-validation">Parameter Validation</h3>
<p>The first part of the function validates that parameters meet certain criteria. That criteria is as follows:</p>
<ol type="1">
<li>Only one year value should be passed in the parameter</li>
<li>The year parameter value should be between 2010 &amp; 2022</li>
<li>Numeric variables, categorical variables and the geography level had to be valid variables in a pre-approved list</li>
<li>One numeric variables other than PWGTP had to be passed in the numericVars parameter.</li>
<li>One categorical variable must be passed in the catVars parameter</li>
</ol>
<p>If these criteria are not met, a detailed stop() message is returned by the function</p>
</section>
<section id="using-parameters-to-construct-api" class="level3">
<h3 class="anchored" data-anchor-id="using-parameters-to-construct-api">Using Parameters to Construct API</h3>
<p>To construct the API URL, we need the constant components (base), the year, a list of variables and the geography specification. Year is directly passed by the user with no transformations. We create our variables list by unioning the numericVars and catVars parameter values and delimiting with a comma (,).</p>
<p>For the geography specification, we use switch() and if else functions to follow these generic rules:</p>
<ul>
<li>If the user passes “All” in geographyLevel, return an empty string</li>
<li>If the user passes another value in geography level return in the following format “geographyLevel:geographySpec”. An example is “state:17”</li>
<li>If the user passes another value in geography level and does NOT include a geography spec, return everything for that level in the format (example) of “state:*”, with an asterik representing all.</li>
</ul>
<p>Paste all of these string values together to construct the API and use httr:get() and our helpfer function the return a tibble called “data”</p>
</section>
<section id="post-api-transformations" class="level3">
<h3 class="anchored" data-anchor-id="post-api-transformations">Post API Transformations</h3>
<p>All of the values in the tibble are “character” data type and our category variable values are keys.</p>
<p>To make this more usable we are….</p>
<ol type="1">
<li>Converting our numeric variables to “numeric” type</li>
<li>Looking up time values for our time variables and returning the median time in the provided interval in HMS format</li>
<li>Lookup up categorical values and apply our factor function.</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>retrieveCensus <span class="ot">&lt;-</span> <span class="cf">function</span>(<span class="at">year=</span><span class="dv">2022</span>,<span class="at">numericVars=</span><span class="fu">c</span>(<span class="st">"AGEP"</span>,<span class="st">"PWGTP"</span>),<span class="at">catVars=</span><span class="fu">c</span>(<span class="st">"SEX"</span>),<span class="at">geographyLevel =</span><span class="fu">c</span>(<span class="st">"All"</span>),<span class="at">geographySpec =</span> <span class="cn">NULL</span>){</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Check if year is a single value AND the value passed is between 2010 and 2022</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">length</span>(year)<span class="sc">!=</span><span class="dv">1</span>){</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stop</span>(<span class="st">"A single year must be passed"</span>)</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (year <span class="sc">&lt;</span> <span class="dv">2010</span> <span class="sc">|</span> year <span class="sc">&gt;</span> <span class="dv">2022</span>){</span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stop</span>(<span class="st">"The year passed must be between 2010 &amp; 2022"</span>)</span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Check if values passed in the numericVars (catVars) are within the numericOptions (catOptions) vector(s)</span></span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a>  numericReq <span class="ot">&lt;-</span> <span class="st">"PWGTP"</span></span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a>  numericOptions <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"AGEP"</span>,<span class="st">"GASP"</span>,<span class="st">"GRPIP"</span>,<span class="st">"JWMNP"</span>,<span class="st">"PWGTP"</span>)</span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a>  timeOptions <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"JWAP"</span>,<span class="st">"JWDP"</span>)</span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb7-19"><a href="#cb7-19" aria-hidden="true" tabindex="-1"></a>  numericTimeOptions <span class="ot">&lt;-</span> <span class="fu">c</span>(numericOptions,timeOptions)</span>
<span id="cb7-20"><a href="#cb7-20" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb7-21"><a href="#cb7-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">checkVarsValid</span>(<span class="at">var=</span>numericVars,<span class="at">validVars =</span> numericTimeOptions)</span>
<span id="cb7-22"><a href="#cb7-22" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb7-23"><a href="#cb7-23" aria-hidden="true" tabindex="-1"></a>  catOptions <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"FER"</span>,<span class="st">"HHL"</span>,<span class="st">"HISPEED"</span>,<span class="st">"JWTRNS"</span>,<span class="st">"SCH"</span>,<span class="st">"SCHL"</span>,<span class="st">"SEX"</span>)</span>
<span id="cb7-24"><a href="#cb7-24" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb7-25"><a href="#cb7-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">checkVarsValid</span>(<span class="at">vars=</span>catVars, <span class="at">validVars =</span> catOptions)</span>
<span id="cb7-26"><a href="#cb7-26" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb7-27"><a href="#cb7-27" aria-hidden="true" tabindex="-1"></a>  geographyOptions <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"All"</span>,<span class="st">"Region"</span>,<span class="st">"Division"</span>,<span class="st">"State"</span>)</span>
<span id="cb7-28"><a href="#cb7-28" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb7-29"><a href="#cb7-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">checkVarsValid</span>(<span class="at">vars=</span>geographyLevel, <span class="at">validVars =</span> geographyOptions)</span>
<span id="cb7-30"><a href="#cb7-30" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb7-31"><a href="#cb7-31" aria-hidden="true" tabindex="-1"></a>  <span class="do">## If PWGTP not in the numericVars parameter, add it</span></span>
<span id="cb7-32"><a href="#cb7-32" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb7-33"><a href="#cb7-33" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (numericReq <span class="sc">%in%</span> numericVars) {</span>
<span id="cb7-34"><a href="#cb7-34" aria-hidden="true" tabindex="-1"></a>    numericVars <span class="ot">&lt;-</span> numericVars</span>
<span id="cb7-35"><a href="#cb7-35" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb7-36"><a href="#cb7-36" aria-hidden="true" tabindex="-1"></a>    numericVars <span class="ot">&lt;-</span> <span class="fu">c</span>(numericVars,numericReq)</span>
<span id="cb7-37"><a href="#cb7-37" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb7-38"><a href="#cb7-38" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb7-39"><a href="#cb7-39" aria-hidden="true" tabindex="-1"></a>  <span class="do">## Check to make sure the number of numeric variables that will be returned is NOT &lt; 2. The number of categorical variables should not be &lt; 1</span></span>
<span id="cb7-40"><a href="#cb7-40" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb7-41"><a href="#cb7-41" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">length</span>(numericVars) <span class="sc">&lt;</span> <span class="dv">2</span>) {</span>
<span id="cb7-42"><a href="#cb7-42" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stop</span>(<span class="st">"One numeric variable other than "</span>, <span class="fu">paste</span>(numericReq),<span class="st">" must be given in the numericVars parameter"</span>)</span>
<span id="cb7-43"><a href="#cb7-43" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb7-44"><a href="#cb7-44" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb7-45"><a href="#cb7-45" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">length</span>(catVars) <span class="sc">&lt;</span> <span class="dv">1</span>) {</span>
<span id="cb7-46"><a href="#cb7-46" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stop</span>(<span class="st">"One categorical variable must be given to be returned"</span>)</span>
<span id="cb7-47"><a href="#cb7-47" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb7-48"><a href="#cb7-48" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb7-49"><a href="#cb7-49" aria-hidden="true" tabindex="-1"></a> <span class="do">## If all variables are of valid length and valid values, paste them together to be passed in the API call</span></span>
<span id="cb7-50"><a href="#cb7-50" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb7-51"><a href="#cb7-51" aria-hidden="true" tabindex="-1"></a>  regioninPrefix <span class="ot">&lt;-</span> <span class="cf">switch</span>(</span>
<span id="cb7-52"><a href="#cb7-52" aria-hidden="true" tabindex="-1"></a>    geographyLevel,</span>
<span id="cb7-53"><a href="#cb7-53" aria-hidden="true" tabindex="-1"></a>    <span class="at">All =</span> <span class="st">""</span>,</span>
<span id="cb7-54"><a href="#cb7-54" aria-hidden="true" tabindex="-1"></a>    <span class="at">Division =</span> <span class="st">"division"</span>,</span>
<span id="cb7-55"><a href="#cb7-55" aria-hidden="true" tabindex="-1"></a>    <span class="at">Region =</span> <span class="st">"region"</span>,</span>
<span id="cb7-56"><a href="#cb7-56" aria-hidden="true" tabindex="-1"></a>    <span class="at">State =</span> <span class="st">"state"</span></span>
<span id="cb7-57"><a href="#cb7-57" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb7-58"><a href="#cb7-58" aria-hidden="true" tabindex="-1"></a>  regioninSuffix <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(<span class="fu">is.null</span>(geographySpec),<span class="st">"*"</span>,geographySpec)</span>
<span id="cb7-59"><a href="#cb7-59" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb7-60"><a href="#cb7-60" aria-hidden="true" tabindex="-1"></a>  regioninString <span class="ot">&lt;-</span> <span class="cf">if</span>(regioninPrefix<span class="sc">!=</span><span class="st">""</span>){<span class="fu">paste0</span>(<span class="st">'&amp;for='</span>,regioninPrefix,<span class="st">":"</span>,regioninSuffix)}</span>
<span id="cb7-61"><a href="#cb7-61" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb7-62"><a href="#cb7-62" aria-hidden="true" tabindex="-1"></a>  allVarsReq <span class="ot">&lt;-</span> <span class="fu">c</span>(numericVars,catVars)</span>
<span id="cb7-63"><a href="#cb7-63" aria-hidden="true" tabindex="-1"></a>  varString <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb7-64"><a href="#cb7-64" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb7-65"><a href="#cb7-65" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (value <span class="cf">in</span> allVarsReq){</span>
<span id="cb7-66"><a href="#cb7-66" aria-hidden="true" tabindex="-1"></a>    varString <span class="ot">&lt;-</span> <span class="fu">paste0</span>(varString,value,<span class="cf">if</span>(value <span class="sc">!=</span> allVarsReq[<span class="fu">length</span>(allVarsReq)]){<span class="st">","</span>})</span>
<span id="cb7-67"><a href="#cb7-67" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb7-68"><a href="#cb7-68" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb7-69"><a href="#cb7-69" aria-hidden="true" tabindex="-1"></a>  <span class="do">## Build API, fetch data, convert to tibble</span></span>
<span id="cb7-70"><a href="#cb7-70" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb7-71"><a href="#cb7-71" aria-hidden="true" tabindex="-1"></a>  apiURL <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">'https://api.census.gov/data/'</span>,year,<span class="st">'/acs/acs1/pums?get='</span>,varString,regioninString)</span>
<span id="cb7-72"><a href="#cb7-72" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb7-73"><a href="#cb7-73" aria-hidden="true" tabindex="-1"></a>  rawData <span class="ot">&lt;-</span> httr<span class="sc">::</span><span class="fu">GET</span>(apiURL)</span>
<span id="cb7-74"><a href="#cb7-74" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb7-75"><a href="#cb7-75" aria-hidden="true" tabindex="-1"></a>  data <span class="ot">&lt;-</span> <span class="fu">rawToTibble</span>(rawData)</span>
<span id="cb7-76"><a href="#cb7-76" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb7-77"><a href="#cb7-77" aria-hidden="true" tabindex="-1"></a>  <span class="do">## Change data types</span></span>
<span id="cb7-78"><a href="#cb7-78" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb7-79"><a href="#cb7-79" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (value <span class="cf">in</span> <span class="fu">intersect</span>(numericVars,timeOptions)){</span>
<span id="cb7-80"><a href="#cb7-80" aria-hidden="true" tabindex="-1"></a>    data <span class="ot">&lt;-</span> <span class="fu">lkpToMiddleTime</span>(data,<span class="at">year=</span>year,<span class="at">timeVar =</span> value)</span>
<span id="cb7-81"><a href="#cb7-81" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb7-82"><a href="#cb7-82" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb7-83"><a href="#cb7-83" aria-hidden="true" tabindex="-1"></a>  data[numericVars[numericVars <span class="sc">%in%</span> numericOptions]] <span class="ot">&lt;-</span> <span class="fu">lapply</span>(data[numericVars[numericVars <span class="sc">%in%</span> numericOptions]],as.numeric)</span>
<span id="cb7-84"><a href="#cb7-84" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb7-85"><a href="#cb7-85" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (value <span class="cf">in</span> catVars){</span>
<span id="cb7-86"><a href="#cb7-86" aria-hidden="true" tabindex="-1"></a>    data <span class="ot">&lt;-</span> <span class="fu">factorLkp</span>(data,<span class="at">year=</span>year,<span class="at">catVar =</span> value)</span>
<span id="cb7-87"><a href="#cb7-87" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb7-88"><a href="#cb7-88" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb7-89"><a href="#cb7-89" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(data)</span>
<span id="cb7-90"><a href="#cb7-90" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="using-our-api-function" class="level2">
<h2 class="anchored" data-anchor-id="using-our-api-function">Using our API Function</h2>
<p>Lets show an example of how our API call works (and that it works). For a state (code 17), we want to retrieve AGEP,PWGTP,JWDP,FER and SEX variables from the 2022 PUMS data set.</p>
<p>AGEP,PWGTP are numeric. JWDP is time value. FER and SEX are categorical</p>
<p>We see in the output the rules defined in the previous section have been followed.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>state17 <span class="ot">&lt;-</span> <span class="fu">retrieveCensus</span>(<span class="at">year=</span><span class="dv">2021</span>,<span class="at">numericVars=</span><span class="fu">c</span>(<span class="st">"AGEP"</span>,<span class="st">"PWGTP"</span>,<span class="st">"JWDP"</span>),<span class="at">catVars=</span><span class="fu">c</span>(<span class="st">"FER"</span>,<span class="st">"SEX"</span>,<span class="st">"SCHL"</span>),<span class="at">geographyLevel =</span> <span class="st">"State"</span>,<span class="at">geographySpec =</span> <span class="dv">17</span>)</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>state17</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 85,053 × 7
    AGEP PWGTP FER                                       SEX   SCHL  state JWDP 
   &lt;dbl&gt; &lt;dbl&gt; &lt;fct&gt;                                     &lt;fct&gt; &lt;fct&gt; &lt;chr&gt; &lt;tim&gt;
 1    37   104 N/A (less than 15 years/greater than 50 … Male  Grad… 17       NA
 2    48    29 No                                        Fema… Regu… 17       NA
 3    66    19 N/A (less than 15 years/greater than 50 … Fema… Mast… 17       NA
 4    51    84 N/A (less than 15 years/greater than 50 … Male  No s… 17       NA
 5    86     4 N/A (less than 15 years/greater than 50 … Male  1 or… 17       NA
 6    32    86 N/A (less than 15 years/greater than 50 … Male  GED … 17       NA
 7    61    30 N/A (less than 15 years/greater than 50 … Fema… Regu… 17       NA
 8    50    38 No                                        Fema… Regu… 17       NA
 9    74     6 N/A (less than 15 years/greater than 50 … Fema… Grad… 17       NA
10    36     8 N/A (less than 15 years/greater than 50 … Male  Regu… 17       NA
# ℹ 85,043 more rows</code></pre>
</div>
</div>
</section>
<section id="what-if-i-want-multiple-years-of-data" class="level2">
<h2 class="anchored" data-anchor-id="what-if-i-want-multiple-years-of-data">What if I want multiple years of data?</h2>
<p>For multiple years of data, we have to make a separate API call and data processes for EACH year and union these datasets together in one tibble.</p>
<p>Our function takes in the same parameters as our previous function for single year. This is because we are iterating through each value in our year vector, grabbing the same variables form that years API and then appending.</p>
<p>To know what year the data came from, we append the “year” to the unioned tibble.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>retrieveMultiYearCensus <span class="ot">&lt;-</span> <span class="cf">function</span>(<span class="at">years=</span><span class="fu">c</span>(<span class="dv">2022</span>),<span class="at">numericVars=</span><span class="fu">c</span>(<span class="st">"AGEP"</span>,<span class="st">"PWGTP"</span>),<span class="at">catVars=</span><span class="fu">c</span>(<span class="st">"SEX"</span>),<span class="at">geographyLevel =</span><span class="fu">c</span>(<span class="st">"All"</span>),<span class="at">geographySpec =</span> <span class="cn">NULL</span>) {</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>  combinedTibble <span class="ot">&lt;-</span> <span class="fu">retrieveCensus</span>(<span class="at">year=</span>years[<span class="dv">1</span>],<span class="at">numericVars=</span>numericVars,<span class="at">catVars=</span>catVars,<span class="at">geographyLevel=</span>geographyLevel,<span class="at">geographySpec =</span> geographySpec)</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>  combinedTibble<span class="sc">$</span>year <span class="ot">&lt;-</span> years[<span class="dv">1</span>]</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">2</span><span class="sc">:</span><span class="fu">length</span>(years)) {</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>    yearTibble <span class="ot">&lt;-</span> <span class="fu">retrieveCensus</span>(<span class="at">year=</span>years[i],<span class="at">numericVars=</span>numericVars,<span class="at">catVars=</span>catVars,<span class="at">geographyLevel=</span>geographyLevel,<span class="at">geographySpec =</span> geographySpec)</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>    yearTibble<span class="sc">$</span>year <span class="ot">&lt;-</span> years[i]</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>    combinedTibble <span class="ot">&lt;-</span> dplyr<span class="sc">::</span><span class="fu">union</span>(combinedTibble,yearTibble)</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(combinedTibble)</span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="using-our-multi-year-function" class="level2">
<h2 class="anchored" data-anchor-id="using-our-multi-year-function">Using our multi-year function</h2>
<p>Again, this is the same function so the arguments for <code>retrieveMultiYearCensus</code> are almost identical to <code>retrieveCensus</code>. The only difference is <code>retrieveMultiYearCensus</code> accepts a multi-value vector of years.</p>
<p>Lets test this on years 2021 and 2022 with a state (code 17). We will return our default parameters.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>state17MultiYear <span class="ot">&lt;-</span> <span class="fu">retrieveMultiYearCensus</span>(<span class="at">years=</span><span class="fu">c</span>(<span class="dv">2021</span>,<span class="dv">2022</span>),<span class="at">geographyLevel =</span> <span class="st">"State"</span>,<span class="at">geographySpec =</span> <span class="dv">17</span>)</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>state17MultiYear</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 81,469 × 5
    AGEP PWGTP SEX    state  year
   &lt;dbl&gt; &lt;dbl&gt; &lt;fct&gt;  &lt;chr&gt; &lt;dbl&gt;
 1    37   104 Male   17     2021
 2    48    29 Female 17     2021
 3    66    19 Female 17     2021
 4    51    84 Male   17     2021
 5    86     4 Male   17     2021
 6    32    86 Male   17     2021
 7    61    30 Female 17     2021
 8    50    38 Female 17     2021
 9    74     6 Female 17     2021
10    36     8 Male   17     2021
# ℹ 81,459 more rows</code></pre>
</div>
</div>
</section>
<section id="test-retrievecensus-function" class="level2">
<h2 class="anchored" data-anchor-id="test-retrievecensus-function">Test <code>retrieveCensus</code> function</h2>
<p>This test dataset is intended to test that data called from the API using the <code>retrieveCensus</code> function will be usable by the <code>censusSummerizR</code> function below.</p>
<ol type="1">
<li>numeric and categorical variables were selected psuedo-randomly to test function.</li>
<li>extracted data were placed into <code>censusData</code> object.</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>censusData<span class="ot">&lt;-</span><span class="fu">retrieveCensus</span>(<span class="at">year=</span><span class="dv">2022</span>, <span class="at">numericVars=</span><span class="fu">c</span>(<span class="st">"AGEP"</span>, <span class="st">"GASP"</span>, <span class="st">"PWGTP"</span>, <span class="st">"JWAP"</span>, <span class="st">"JWDP"</span>), <span class="at">catVars =</span> <span class="fu">c</span>(<span class="st">"SEX"</span>, <span class="st">"HHL"</span>),<span class="at">geographyLevel =</span> <span class="st">"State"</span>, <span class="at">geographySpec =</span> <span class="dv">17</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="check-retrievecensus-function-output-object-structure." class="level3">
<h3 class="anchored" data-anchor-id="check-retrievecensus-function-output-object-structure.">Check <code>retrieveCensus</code> function output object structure.</h3>
<p>The code chunk below can be used to visualize the structure of the data extracted by the <code>retrieveCensus</code> function. These visualizations can be helpful to understand the types of data presented (in truncated form), some representative values, and help the developer think of ways these data can be manipulated during creation of downstream functions. <code>names</code> shows the column names, <code>length()</code> give us a number of items in the object, <code>str()</code> tells us the stucture of the object, and calling <code>censusData</code> shows us the first 1000 rows of the object. This code will run, but we will not display the output to conserve space!</p>
</section>
</section>
<section id="create-custom-summary-function" class="level1">
<h1>Create custom summary function</h1>
<p>The <code>censusSummerizR</code> function takes the dataset object that is output from the <code>retrieveCensus</code> function and outputs a named list of the following:</p>
<ul>
<li>Sample Mean and Sample Standard Deviation for the numeric variables</li>
<li>Sample counts of observations categorized by factor levels for factor variables</li>
</ul>
<p>The <code>censusSummerizR</code> function takes the full dataset object and splits into two seperate datasets that are susequently utilized for statistical calulations and counts, as appropriate:</p>
<ul>
<li>An object of numeric data</li>
<li>An object of categorical data</li>
</ul>
<p>The user selects from a list of both numeric and categorical variables to summarize and if the variable requested by the user is not present in the supplied source dataset, the procedure stops and alerts the user:</p>
<p><code>"You cannot subset data that was not pulled from API, re-pull desired variables"</code></p>
<p>The output of the <code>censusSummerizR</code> function is a list of tibbles that contain:</p>
<ul>
<li>A single tibble that calculates sample mean and sample standard deviation for all numeric variables, and</li>
<li>An individual tibble that summarizes counts of each factor for that variable</li>
</ul>
<p><em>Notes to user: <code>censusSummerizR</code> function will calculate weighted sample mean and weighted sample standard deviations for the numeric variables of interest and will calculate counts of the categorical variables of interest. User should select variables to summarize that were pulled from the PUMS Census API using one of the <code>retrieveCensus</code> or <code>retrieveMultiYearCensus</code> functions. Variables not in your starting dataset will cause <code>censusSummerizR</code> to stop. <code>PWGTP</code> should not be summarized as it is an observation weight.</em></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>censusSummerizR <span class="ot">&lt;-</span> <span class="cf">function</span>(x, <span class="at">numericVars=</span><span class="fu">c</span>(<span class="st">"AGEP"</span>,<span class="st">"GASP"</span>,<span class="st">"GRPIP"</span>,<span class="st">"JWMNP"</span>),   <span class="at">catVars=</span><span class="fu">c</span>(<span class="st">"FER"</span>,<span class="st">"HHL"</span>,<span class="st">"HISPEED"</span>,<span class="st">"JWTRNS"</span>,<span class="st">"SCH"</span>,<span class="st">"SCHL"</span>,<span class="st">"SEX"</span>)){</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a><span class="co">#check user requested variables and create numeric and factor/character datasets to summarize seperately based on user choice of variables to explore</span></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>numericDataDefault <span class="ot">&lt;-</span> x <span class="sc">|&gt;</span></span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">where</span>(is.numeric))</span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a>charDataDefault <span class="ot">&lt;-</span> x<span class="sc">|&gt;</span></span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">where</span>(is.factor))</span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="fu">length</span>(<span class="fu">names</span>(numericDataDefault))<span class="sc">&lt;</span><span class="fu">length</span>(numericVars)){</span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stop</span>(<span class="st">"You cannot subset data that was not pulled from API, re-pull desired variables"</span>)</span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb14-15"><a href="#cb14-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-16"><a href="#cb14-16" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="fu">length</span>(<span class="fu">names</span>(charDataDefault))<span class="sc">&lt;</span><span class="fu">length</span>(catVars)){</span>
<span id="cb14-17"><a href="#cb14-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stop</span>(<span class="st">"You cannot subset data that was not pulled from API, re-pull desired variables"</span>)</span>
<span id="cb14-18"><a href="#cb14-18" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb14-19"><a href="#cb14-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-20"><a href="#cb14-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-21"><a href="#cb14-21" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="fu">length</span>(<span class="fu">names</span>(numericDataDefault))<span class="sc">&gt;</span><span class="fu">length</span>(numericVars)){</span>
<span id="cb14-22"><a href="#cb14-22" aria-hidden="true" tabindex="-1"></a>  numericData<span class="ot">&lt;-</span> x <span class="sc">|&gt;</span> </span>
<span id="cb14-23"><a href="#cb14-23" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(numericVars)</span>
<span id="cb14-24"><a href="#cb14-24" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb14-25"><a href="#cb14-25" aria-hidden="true" tabindex="-1"></a>  numericData<span class="ot">&lt;-</span> numericDataDefault <span class="sc">|&gt;</span></span>
<span id="cb14-26"><a href="#cb14-26" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(<span class="fu">where</span>(<span class="sc">-</span><span class="st">"PWGTP"</span>))</span>
<span id="cb14-27"><a href="#cb14-27" aria-hidden="true" tabindex="-1"></a>} </span>
<span id="cb14-28"><a href="#cb14-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-29"><a href="#cb14-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-30"><a href="#cb14-30" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="fu">length</span>(<span class="fu">names</span>(charDataDefault<span class="sc">$</span>names))<span class="sc">&gt;</span><span class="fu">length</span>(catVars)){</span>
<span id="cb14-31"><a href="#cb14-31" aria-hidden="true" tabindex="-1"></a>  charData<span class="ot">&lt;-</span> x <span class="sc">|&gt;</span> </span>
<span id="cb14-32"><a href="#cb14-32" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(catVars)</span>
<span id="cb14-33"><a href="#cb14-33" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb14-34"><a href="#cb14-34" aria-hidden="true" tabindex="-1"></a>  charData<span class="ot">&lt;-</span> charDataDefault </span>
<span id="cb14-35"><a href="#cb14-35" aria-hidden="true" tabindex="-1"></a>}    </span>
<span id="cb14-36"><a href="#cb14-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-37"><a href="#cb14-37" aria-hidden="true" tabindex="-1"></a><span class="co">#create loop to mean each variable from numericData and place in list with name</span></span>
<span id="cb14-38"><a href="#cb14-38" aria-hidden="true" tabindex="-1"></a>splMean <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb14-39"><a href="#cb14-39" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(numericData)){</span>
<span id="cb14-40"><a href="#cb14-40" aria-hidden="true" tabindex="-1"></a>  splMean[[i]] <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>((<span class="fu">sum</span>(numericData[[i]] <span class="sc">%*%</span> x<span class="sc">$</span>PWGTP)<span class="sc">/</span><span class="fu">sum</span>(x<span class="sc">$</span>PWGTP)))</span>
<span id="cb14-41"><a href="#cb14-41" aria-hidden="true" tabindex="-1"></a>  <span class="fu">names</span>(splMean)[i]<span class="ot">&lt;-</span><span class="fu">paste</span>(<span class="fu">names</span>(numericData[i]))</span>
<span id="cb14-42"><a href="#cb14-42" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb14-43"><a href="#cb14-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-44"><a href="#cb14-44" aria-hidden="true" tabindex="-1"></a><span class="co">#create loop to calculate sample SD from numericData and place in list with name</span></span>
<span id="cb14-45"><a href="#cb14-45" aria-hidden="true" tabindex="-1"></a>splSD <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb14-46"><a href="#cb14-46" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(numericData)){</span>
<span id="cb14-47"><a href="#cb14-47" aria-hidden="true" tabindex="-1"></a>  splSD[[i]] <span class="ot">&lt;-</span> (<span class="fu">sqrt</span>(<span class="fu">sum</span>(numericData[[i]]<span class="sc">^</span><span class="dv">2</span> <span class="sc">%*%</span> x<span class="sc">$</span>PWGTP)<span class="sc">/</span><span class="fu">sum</span>(x<span class="sc">$</span>PWGTP)<span class="sc">-</span>splMean[[i]]<span class="sc">^</span><span class="dv">2</span>))</span>
<span id="cb14-48"><a href="#cb14-48" aria-hidden="true" tabindex="-1"></a>  <span class="fu">names</span>(splSD)[i]<span class="ot">&lt;-</span><span class="fu">paste</span>(<span class="fu">names</span>(numericData[i]))</span>
<span id="cb14-49"><a href="#cb14-49" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb14-50"><a href="#cb14-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-51"><a href="#cb14-51" aria-hidden="true" tabindex="-1"></a><span class="co">#coerce splMean and splSD to Tibbles</span></span>
<span id="cb14-52"><a href="#cb14-52" aria-hidden="true" tabindex="-1"></a>splMeanTbl<span class="ot">&lt;-</span><span class="fu">as_tibble</span>(splMean)</span>
<span id="cb14-53"><a href="#cb14-53" aria-hidden="true" tabindex="-1"></a>splSDTbl<span class="ot">&lt;-</span><span class="fu">as_tibble</span>(splSD)</span>
<span id="cb14-54"><a href="#cb14-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-55"><a href="#cb14-55" aria-hidden="true" tabindex="-1"></a><span class="co">#Create loop to generate counts for each categorical variable</span></span>
<span id="cb14-56"><a href="#cb14-56" aria-hidden="true" tabindex="-1"></a>catSummary <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb14-57"><a href="#cb14-57" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(charData)){</span>
<span id="cb14-58"><a href="#cb14-58" aria-hidden="true" tabindex="-1"></a>  catSummary[[i]]<span class="ot">&lt;-</span> charData[i] <span class="sc">|&gt;</span></span>
<span id="cb14-59"><a href="#cb14-59" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(charData[i]) <span class="sc">|&gt;</span></span>
<span id="cb14-60"><a href="#cb14-60" aria-hidden="true" tabindex="-1"></a>      <span class="fu">summarize</span>(<span class="at">n=</span><span class="fu">n</span>())</span>
<span id="cb14-61"><a href="#cb14-61" aria-hidden="true" tabindex="-1"></a>    <span class="fu">names</span>(catSummary)[i]<span class="ot">&lt;-</span><span class="fu">paste</span>(<span class="st">"count"</span>, <span class="fu">names</span>(charData[i]), <span class="at">sep=</span><span class="st">"_"</span>)</span>
<span id="cb14-62"><a href="#cb14-62" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb14-63"><a href="#cb14-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-64"><a href="#cb14-64" aria-hidden="true" tabindex="-1"></a><span class="co">#assemble tibble of data for numeric variables</span></span>
<span id="cb14-65"><a href="#cb14-65" aria-hidden="true" tabindex="-1"></a>numSumRowNames <span class="ot">&lt;-</span> <span class="fu">as_tibble</span>(<span class="fu">c</span>(<span class="st">"splMean"</span>, <span class="st">"splSD"</span>))</span>
<span id="cb14-66"><a href="#cb14-66" aria-hidden="true" tabindex="-1"></a>numericSum <span class="ot">&lt;-</span> <span class="fu">tibble</span>()</span>
<span id="cb14-67"><a href="#cb14-67" aria-hidden="true" tabindex="-1"></a>numericSum <span class="ot">&lt;-</span> <span class="fu">as_tibble</span>(<span class="fu">bind_rows</span>(splMeanTbl,splSDTbl))</span>
<span id="cb14-68"><a href="#cb14-68" aria-hidden="true" tabindex="-1"></a>numericSumNamed <span class="ot">&lt;-</span> <span class="fu">as_tibble</span>(<span class="fu">bind_cols</span>(numSumRowNames,numericSum))</span>
<span id="cb14-69"><a href="#cb14-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-70"><a href="#cb14-70" aria-hidden="true" tabindex="-1"></a><span class="co">#Need to place "numericSumNamed" in its own named list so that output is visually appealing, and each object is of similar dimensions.</span></span>
<span id="cb14-71"><a href="#cb14-71" aria-hidden="true" tabindex="-1"></a>meanSD <span class="ot">&lt;-</span><span class="fu">list</span>(numericSumNamed)</span>
<span id="cb14-72"><a href="#cb14-72" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(meanSD) <span class="ot">&lt;-</span> <span class="st">"Mean and SD"</span></span>
<span id="cb14-73"><a href="#cb14-73" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-74"><a href="#cb14-74" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-75"><a href="#cb14-75" aria-hidden="true" tabindex="-1"></a><span class="co">#Return liSt of numeric and categorical summaries</span></span>
<span id="cb14-76"><a href="#cb14-76" aria-hidden="true" tabindex="-1"></a><span class="fu">return</span>(<span class="fu">c</span>(catSummary,meanSD))</span>
<span id="cb14-77"><a href="#cb14-77" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-78"><a href="#cb14-78" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="test-out-censussummerizr-function" class="level2">
<h2 class="anchored" data-anchor-id="test-out-censussummerizr-function">Test out <code>censusSummerizR</code> Function</h2>
<p>Now that the <code>censusSummerizR</code> function has been written, we need to make sure that it works as intended. The variables below are representative numeric and categorical variables and return summaries, exclusive of the “weight” variable, <code>PWGTP</code>. A list of tibbles that describe the sample mean, sample SD and counts is returned.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>summaryList<span class="ot">&lt;-</span><span class="fu">censusSummerizR</span>(censusData, <span class="at">numericVars =</span> <span class="fu">c</span>(<span class="st">"AGEP"</span>, <span class="st">"GASP"</span>), <span class="at">catVars =</span> <span class="fu">c</span>( <span class="st">"SEX"</span>))</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>summaryList</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$count_SEX
# A tibble: 2 × 2
  SEX        n
  &lt;fct&gt;  &lt;int&gt;
1 Male   38888
2 Female 43699

$count_HHL
# A tibble: 6 × 2
  HHL                                    n
  &lt;fct&gt;                              &lt;int&gt;
1 N/A (GQ/vacant)                     4681
2 English Only                       60302
3 Spanish                             8908
4 Other Indo-European languages       4886
5 Asian and Pacific Island languages  2833
6 Other Language                       977

$`Mean and SD`
# A tibble: 2 × 3
  value    AGEP  GASP
  &lt;chr&gt;   &lt;dbl&gt; &lt;dbl&gt;
1 splMean  38.0  115.
2 splSD    26.9  199.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Present example data in rendered webpage in nicely formatted tables</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(summaryList[<span class="dv">1</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="kable_wrapper">
<tbody>
<tr>
<td>
<table class="caption-top table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;">SEX</th>
<th style="text-align: right;">n</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Male</td>
<td style="text-align: right;">38888</td>
</tr>
<tr class="even">
<td style="text-align: left;">Female</td>
<td style="text-align: right;">43699</td>
</tr>
</tbody>
</table>
</td>
</tr>
</tbody>
</table>
</div>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(summaryList[<span class="dv">2</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="kable_wrapper">
<tbody>
<tr>
<td>
<table class="caption-top table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;">HHL</th>
<th style="text-align: right;">n</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">N/A (GQ/vacant)</td>
<td style="text-align: right;">4681</td>
</tr>
<tr class="even">
<td style="text-align: left;">English Only</td>
<td style="text-align: right;">60302</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Spanish</td>
<td style="text-align: right;">8908</td>
</tr>
<tr class="even">
<td style="text-align: left;">Other Indo-European languages</td>
<td style="text-align: right;">4886</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Asian and Pacific Island languages</td>
<td style="text-align: right;">2833</td>
</tr>
<tr class="even">
<td style="text-align: left;">Other Language</td>
<td style="text-align: right;">977</td>
</tr>
</tbody>
</table>
</td>
</tr>
</tbody>
</table>
</div>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(summaryList[<span class="dv">3</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="kable_wrapper">
<tbody>
<tr>
<td>
<table class="caption-top table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;">value</th>
<th style="text-align: right;">AGEP</th>
<th style="text-align: right;">GASP</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">splMean</td>
<td style="text-align: right;">37.97134</td>
<td style="text-align: right;">115.0748</td>
</tr>
<tr class="even">
<td style="text-align: left;">splSD</td>
<td style="text-align: right;">26.87618</td>
<td style="text-align: right;">198.8157</td>
</tr>
</tbody>
</table>
</td>
</tr>
</tbody>
</table>
</div>
</div>
</section>
<section id="generate-function-to-plot-output-retrieved-from-pums-census-api" class="level2">
<h2 class="anchored" data-anchor-id="generate-function-to-plot-output-retrieved-from-pums-census-api">Generate function to plot output retrieved from PUMS Census API</h2>
<p>The function <code>censusPlotR</code> will generate box plots for character variables that are returned as categorical from <code>retrieveCensus</code>. This can help the user visualize differences and similarities between categories.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>censusPlotR <span class="ot">&lt;-</span> <span class="cf">function</span>(x, <span class="at">catVars=</span><span class="fu">c</span>(<span class="st">"FER"</span>,<span class="st">"HHL"</span>,<span class="st">"HISPEED"</span>,<span class="st">"JWTRNS"</span>,<span class="st">"SCH"</span>,<span class="st">"SCHL"</span>,<span class="st">"SEX"</span>), <span class="at">numericVars=</span><span class="fu">c</span>(<span class="st">"AGEP"</span>,<span class="st">"GASP"</span>,<span class="st">"GRPIP"</span>,<span class="st">"JWMNP"</span>)){</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a><span class="co">#force user to specify a single numeric and single categorical variable</span></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="fu">length</span>(numericVars)<span class="sc">&gt;</span><span class="dv">1</span>){</span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stop</span>(<span class="st">"You cannot plot more than 1 numeric variable"</span>)</span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="fu">length</span>(catVars)<span class="sc">&gt;</span><span class="dv">1</span>){</span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stop</span>(<span class="st">"You cannot plot more than 1 categorical variable"</span>)</span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(x, <span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">get</span>(catVars), <span class="at">y =</span> <span class="fu">get</span>(numericVars)), <span class="at">weight=</span>PWGTP) <span class="sc">+</span></span>
<span id="cb20-13"><a href="#cb20-13" aria-hidden="true" tabindex="-1"></a>         <span class="fu">geom_boxplot</span>() <span class="sc">+</span></span>
<span id="cb20-14"><a href="#cb20-14" aria-hidden="true" tabindex="-1"></a>         <span class="fu">ggtitle</span>(<span class="st">"Boxplot of User Selected Categorical Variables Weighted by PWGTP"</span>) <span class="sc">+</span></span>
<span id="cb20-15"><a href="#cb20-15" aria-hidden="true" tabindex="-1"></a>         <span class="fu">xlab</span>(catVars) <span class="sc">+</span> </span>
<span id="cb20-16"><a href="#cb20-16" aria-hidden="true" tabindex="-1"></a>         <span class="fu">ylab</span>(numericVars) <span class="sc">+</span></span>
<span id="cb20-17"><a href="#cb20-17" aria-hidden="true" tabindex="-1"></a>         <span class="fu">scale_x_discrete</span>(<span class="at">labels =</span> <span class="cf">function</span>(x) <span class="fu">str_wrap</span>(x, <span class="at">width =</span> <span class="dv">10</span>),</span>
<span id="cb20-18"><a href="#cb20-18" aria-hidden="true" tabindex="-1"></a>                          <span class="at">drop =</span> <span class="cn">FALSE</span>)</span>
<span id="cb20-19"><a href="#cb20-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-20"><a href="#cb20-20" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="test-plot-function" class="level2">
<h2 class="anchored" data-anchor-id="test-plot-function">Test Plot Function</h2>
<p>Here we test the <code>censusPlotR</code> function by plotting <code>AGEP</code> by <code>SEX</code>.</p>
<p>*Notes to User: enter dataset to evaluate in function and enter a single categorical variable and a single numeric variable. The funtion will stop and return the errors: <code>"You cannot plot more than 1 numeric variable"</code> and/or <code>"You cannot plot more than 1 categorical variable"</code> if more than 1 of either variable type is requested.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>summaryPlot <span class="ot">&lt;-</span> <span class="fu">censusPlotR</span>(censusData, <span class="at">catVars=</span> <span class="st">"SEX"</span>, <span class="at">numericVars =</span> <span class="st">"AGEP"</span>)</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>summaryPlot</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="ST588Project1_files/figure-html/unnamed-chunk-14-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="using-it-all-together" class="level2">
<h2 class="anchored" data-anchor-id="using-it-all-together">Using it all together</h2>
<p>We’ve built and tested these functions, but lets use them all together.</p>
<p>I want to explore data from a state (key = 17). I want AGEP, GASP, JWMNP, SEX, HHL, SCH and SCHL variables returned. I want the data for this state from 2020-2022.</p>
<p>A list of variables and there definitions can be found here <a href="https://api.census.gov/data/2022/acs/acs1/pums/variables.html" class="uri">https://api.census.gov/data/2022/acs/acs1/pums/variables.html</a></p>
<p>Lets call our <code>retrieveMultiYearCensus</code> function and pass the appropriate parameters</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>censusStateData <span class="ot">&lt;-</span> <span class="fu">retrieveMultiYearCensus</span>(<span class="at">years=</span><span class="fu">c</span>(<span class="dv">2021</span>,<span class="dv">2022</span>),<span class="at">numericVars =</span> <span class="fu">c</span>(<span class="st">"AGEP"</span>,<span class="st">"GASP"</span>,<span class="st">"JWMNP"</span>),<span class="at">catVars=</span><span class="fu">c</span>(<span class="st">"HHL"</span>,<span class="st">"SCH"</span>,<span class="st">"SCHL"</span>,<span class="st">"SEX"</span>),<span class="at">geographyLevel =</span> <span class="st">"State"</span>,<span class="at">geographySpec =</span> <span class="dv">17</span>)</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>censusStateData</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 250,301 × 10
    AGEP  GASP JWMNP PWGTP HHL             SCH           SCHL  SEX   state  year
   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;fct&gt;           &lt;fct&gt;         &lt;fct&gt; &lt;fct&gt; &lt;chr&gt; &lt;dbl&gt;
 1    37     3     0   104 N/A (GQ/vacant) No, has not … Grad… Male  17     2021
 2    48     3     0    29 N/A (GQ/vacant) No, has not … Regu… Fema… 17     2021
 3    66     3     0    19 N/A (GQ/vacant) No, has not … Mast… Fema… 17     2021
 4    51     3     0    84 N/A (GQ/vacant) No, has not … No s… Male  17     2021
 5    86     3     0     4 N/A (GQ/vacant) No, has not … 1 or… Male  17     2021
 6    32     3     0    86 N/A (GQ/vacant) No, has not … GED … Male  17     2021
 7    61     3     0    30 N/A (GQ/vacant) No, has not … Regu… Fema… 17     2021
 8    50     3     0    38 N/A (GQ/vacant) No, has not … Regu… Fema… 17     2021
 9    74     3     0     6 N/A (GQ/vacant) No, has not … Grad… Fema… 17     2021
10    36     3     0     8 N/A (GQ/vacant) No, has not … Regu… Male  17     2021
# ℹ 250,291 more rows</code></pre>
</div>
</div>
<p>I’m interested in viewing some summary statistics for Age (AGEP), Sex (SEX), School Level (SCHL) and Travel Time to work (JWMNP). Lets use our <code>censusSummerizR</code> and view the output.</p>
<p>For our numeric variables, our mean age is 39.5 with a standard deviation of 23. This means our one standard deviation range is ~ 26 to 62. With just this piece of information, it seems to be a good spread of data!</p>
<p>The distribution of sex (male &amp; female) seems almost uniform (50% each). Our SCHL factor also seems to be on par with what we would expect, which is a somewhat uniform distribution across grade levels. High School Diploma and Bachelors degrees are the highest attainment for those with a high school degree or some post-secondary education.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>censusStateSummary <span class="ot">&lt;-</span> <span class="fu">censusSummerizR</span>(<span class="at">x =</span> censusStateData, <span class="at">numericVars =</span> <span class="fu">c</span>(<span class="st">"AGEP"</span>,<span class="st">"JWMNP"</span>), <span class="at">catVars =</span> <span class="fu">c</span>(<span class="st">"SEX"</span>,<span class="st">"SCHL"</span>))</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>censusStateSummary</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$count_HHL
# A tibble: 6 × 2
  HHL                                     n
  &lt;fct&gt;                               &lt;int&gt;
1 N/A (GQ/vacant)                      9545
2 English Only                       184045
3 Spanish                             29314
4 Other Indo-European languages       15763
5 Asian and Pacific Island languages   8787
6 Other Language                       2847

$count_SCH
# A tibble: 4 × 2
  SCH                                                n
  &lt;fct&gt;                                          &lt;int&gt;
1 N/A (less than 3 years old)                     6579
2 No, has not attended in the last 3 months     189441
3 Yes, public school or public college           42759
4 Yes, private school or college or home school  11522

$count_SCHL
# A tibble: 25 × 2
   SCHL                            n
   &lt;fct&gt;                       &lt;int&gt;
 1 N/A (less than 3 years old)  6579
 2 No schooling completed       7529
 3 Nursery school, preschool    3497
 4 Kindergarten                 2912
 5 Grade 1                      2523
 6 Grade 2                      2747
 7 Grade 3                      2965
 8 Grade 4                      2877
 9 Grade 5                      3045
10 Grade 6                      3933
# ℹ 15 more rows

$count_SEX
# A tibble: 2 × 2
  SEX         n
  &lt;fct&gt;   &lt;int&gt;
1 Male   123047
2 Female 127254

$`Mean and SD`
# A tibble: 2 × 3
  value    AGEP JWMNP
  &lt;chr&gt;   &lt;dbl&gt; &lt;dbl&gt;
1 splMean  39.6  11.0
2 splSD    23.1  19.2</code></pre>
</div>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(censusStateSummary[<span class="dv">1</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="kable_wrapper">
<tbody>
<tr>
<td>
<table class="caption-top table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;">HHL</th>
<th style="text-align: right;">n</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">N/A (GQ/vacant)</td>
<td style="text-align: right;">9545</td>
</tr>
<tr class="even">
<td style="text-align: left;">English Only</td>
<td style="text-align: right;">184045</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Spanish</td>
<td style="text-align: right;">29314</td>
</tr>
<tr class="even">
<td style="text-align: left;">Other Indo-European languages</td>
<td style="text-align: right;">15763</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Asian and Pacific Island languages</td>
<td style="text-align: right;">8787</td>
</tr>
<tr class="even">
<td style="text-align: left;">Other Language</td>
<td style="text-align: right;">2847</td>
</tr>
</tbody>
</table>
</td>
</tr>
</tbody>
</table>
</div>
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(censusStateSummary[<span class="dv">2</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="kable_wrapper">
<tbody>
<tr>
<td>
<table class="caption-top table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;">SCH</th>
<th style="text-align: right;">n</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">N/A (less than 3 years old)</td>
<td style="text-align: right;">6579</td>
</tr>
<tr class="even">
<td style="text-align: left;">No, has not attended in the last 3 months</td>
<td style="text-align: right;">189441</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Yes, public school or public college</td>
<td style="text-align: right;">42759</td>
</tr>
<tr class="even">
<td style="text-align: left;">Yes, private school or college or home school</td>
<td style="text-align: right;">11522</td>
</tr>
</tbody>
</table>
</td>
</tr>
</tbody>
</table>
</div>
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(censusStateSummary[<span class="dv">3</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="kable_wrapper">
<tbody>
<tr>
<td>
<table class="caption-top table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;">SCHL</th>
<th style="text-align: right;">n</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">N/A (less than 3 years old)</td>
<td style="text-align: right;">6579</td>
</tr>
<tr class="even">
<td style="text-align: left;">No schooling completed</td>
<td style="text-align: right;">7529</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Nursery school, preschool</td>
<td style="text-align: right;">3497</td>
</tr>
<tr class="even">
<td style="text-align: left;">Kindergarten</td>
<td style="text-align: right;">2912</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Grade 1</td>
<td style="text-align: right;">2523</td>
</tr>
<tr class="even">
<td style="text-align: left;">Grade 2</td>
<td style="text-align: right;">2747</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Grade 3</td>
<td style="text-align: right;">2965</td>
</tr>
<tr class="even">
<td style="text-align: left;">Grade 4</td>
<td style="text-align: right;">2877</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Grade 5</td>
<td style="text-align: right;">3045</td>
</tr>
<tr class="even">
<td style="text-align: left;">Grade 6</td>
<td style="text-align: right;">3933</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Grade 7</td>
<td style="text-align: right;">3174</td>
</tr>
<tr class="even">
<td style="text-align: left;">Grade 8</td>
<td style="text-align: right;">4836</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Grade 9</td>
<td style="text-align: right;">4237</td>
</tr>
<tr class="even">
<td style="text-align: left;">Grade 10</td>
<td style="text-align: right;">5021</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Grade 11</td>
<td style="text-align: right;">5957</td>
</tr>
<tr class="even">
<td style="text-align: left;">12th grade - no diploma</td>
<td style="text-align: right;">4026</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Regular high school diploma</td>
<td style="text-align: right;">47097</td>
</tr>
<tr class="even">
<td style="text-align: left;">GED or alternative credential</td>
<td style="text-align: right;">7652</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Some college, but less than 1 year</td>
<td style="text-align: right;">15558</td>
</tr>
<tr class="even">
<td style="text-align: left;">1 or more years of college credit, no degree</td>
<td style="text-align: right;">26941</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Associate’s degree</td>
<td style="text-align: right;">17353</td>
</tr>
<tr class="even">
<td style="text-align: left;">Bachelor’s degree</td>
<td style="text-align: right;">42229</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Master’s degree</td>
<td style="text-align: right;">20252</td>
</tr>
<tr class="even">
<td style="text-align: left;">Professional degree beyond a bachelor’s degree</td>
<td style="text-align: right;">4471</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Doctorate degree</td>
<td style="text-align: right;">2890</td>
</tr>
</tbody>
</table>
</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>Lets plot some categorical and numerical variables against each other in a box and whisker plot and see if we notice any trends.</p>
<p>We will see if there’s anything noteworthy when looking at two combinations:</p>
<ol type="1">
<li>AGEP &amp; SCH</li>
<li>JWMNP &amp; SCH</li>
</ol>
<p>For age (AGEP) and current schooling (SCH) we see plots that align with expectations. Many people who have not attended school in the past 3 years are relatively older (IQR roughly 30-62). Those for public school have a smaller center (~13) and a smaller IQR (~10-18). Similarly, those who have attended private school or college or home school have an IQR of ~10-23. All of these patterns meet expectations for current school enrollment based on age</p>
<p>For travel time to work (JWMNP) and current schooling (SCH) we see a more crowded plot, but we can make sense of it! Most have a center near 0 with very small IQRs. Why is this? Well, we are measuring time to work, so to travel to work you are likely a) Not in school or b) 18 and older. 3 of our categories violate one of those conditions, meaning travel time to work will be near 0 because members of these categories are likely not working! The only group we would expect the majority to be working are those who have not attended school in the past 3 years. If you are not in school, it is likely you are employed and working. The upper level of the IQR for those that are working is ~25 minutes.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>ageSchoolPlot <span class="ot">&lt;-</span> <span class="fu">censusPlotR</span>(<span class="at">x=</span>censusStateData,<span class="at">catVars =</span> <span class="st">"SCH"</span>,<span class="at">numericVars=</span><span class="st">"AGEP"</span>)</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>ageSchoolPlot</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="ST588Project1_files/figure-html/unnamed-chunk-17-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>travelSchoolPlot <span class="ot">&lt;-</span> <span class="fu">censusPlotR</span>(<span class="at">x=</span>censusStateData,<span class="at">catVars =</span> <span class="st">"SCH"</span>,<span class="at">numericVars=</span><span class="st">"JWMNP"</span>)</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>travelSchoolPlot</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="ST588Project1_files/figure-html/unnamed-chunk-17-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="conclusion" class="level2">
<h2 class="anchored" data-anchor-id="conclusion">Conclusion</h2>
<p>We’ve illustrated in this project how we can use R to retrieve, transform and analyze data. To recap we built functions that</p>
<ol type="1">
<li>Built and retrieved data from an API URL using user parameters</li>
<li>Transformed API data</li>
<li>Summarized data</li>
<li>Plotted data</li>
</ol>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>